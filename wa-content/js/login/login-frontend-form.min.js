var WaLoginAbstractForm=function(s){var r=function(){};r.className="WaLoginAbstractForm",r.def=function(t,e){for(var r=0,o=arguments.length;r<o;r++)if(void 0!==arguments[r])return arguments[r]};var o=r.def;return r.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},r.prototype.init=function(t){var e=this;e.initVars(t),e.initSubmit(),e.initErrorsAutoCleaner(),e.showErrors(e.errors),e.setFocus(),e.initCaptcha()},r.prototype.initVars=function(t){var e=this;e.$wrapper=o(e.$wrapper,(t=t||{}).$wrapper,s()),e.$form||(e.$form=e.$wrapper.find(".js-wa-form-item"),e.$form.length||(e.$form=e.$wrapper.find("form")),e.$form.length||(e.$form=s())),e.namespace=o(e.namespace,t.namespace,""),e.$templates=o(e.$templates,t.$templates,{}),e.$templates=s.extend({error_msg:s('<em class="wa-error-msg"></em>'),info_msg:s('<div class="wa-info-msg"></div>')},e.$templates),e.classes=o(e.classes,t.classes,{}),e.classes=s.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},e.classes),e.errors=o(e.errors,t.errors,{}),e.locale=o(e.locale,t.locale,{}),e.js_validate=o(e.js_validate,t.js_validate,!0),e.is_json_mode=o(e.is_json_mode,t.is_json_mode),e.className=o(e.className,r.className),e.$captcha=o(e.$captcha,e.$wrapper.find(".wa-captcha-field")),e.need_redirects=void 0===t.need_redirects||!!t.need_redirects,e.env="",e.form_type=""},r.prototype.getFormItem=function(){return this.$form},r.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},r.prototype.getSerializedFormData=function(){var t=this.getFormItem();return t.is("form")?t.serializeArray():(t.find("[data-turn-off=1]").find(":input").attr("disabled",!0),t.find(":input:not(:disabled)").serializeArray())},r.prototype.beforeSubmit=function(){this.getFormItem().find('[name="_csrf"]').val(function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""})},r.prototype.setFocus=function(){},r.prototype.triggerEvent=function(t){var e=this,r={env:e.env,form_type:e.form_type,form_wrapper_id:e.$wrapper.attr("id")},o=(o=Array.prototype.slice.call(arguments)).slice(1);e.$wrapper.trigger(t,o.concat([r]))},r.prototype.initCaptcha=function(){var t=this;t.$wrapper.find(".wa-captcha-field").length?s(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){t.triggerEvent("wa_auth_form_loaded"),t.triggerEvent("wa_auth_form_change_view")}):t.triggerEvent("wa_auth_form_loaded")},r.prototype.turnOffBlock=function(t){var o=this;t.data("turnOff",1).attr("data-turn-off",1).hide(),t.find(":input").attr("disabled",!0),t.find("[type=button],:submit").each(function(){var t=s(this),e=s('<div class="wa-js-old-button-place"></div>'),r=s('<div class="wa-js-new-button-place"></div>');t.after(e),e.data("button",t),r.hide(),o.getFormItem().append(r),r.html(t)}),o.triggerEvent("wa_auth_form_change_view")},r.prototype.turnOnBlock=function(t){t.find(".wa-js-old-button-place").each(function(){var t=s(this),e=t.data("button"),r=e.parent();t.after(e),t.remove(),r.remove()}),t.data("turnOff","").attr("data-turn-off","").show(),t.find(":input").attr("disabled",!1),this.triggerEvent("wa_auth_form_change_view")},r.prototype.isJsonMode=function(){return this.is_json_mode},r.prototype.formatInfoMessage=function(t,e,r){e=void 0===e||e;var o=this.$templates.info_msg.clone();return void 0!==r&&o.data("name",r).attr("data-name",r),e?o.text(s.trim(""+t)):o.html(s.trim(""+t))},r.prototype.getInfoMessages=function(t){var e=this.$wrapper,r="."+this.classes.message_msg;return t&&(r+='[data-name="'+t+'"]'),e.find(r)},r.prototype.clearInfoMessages=function(t){this.getInfoMessages(t).remove(),this.triggerEvent("wa_auth_form_change_view")},r.prototype.showInfoMessages=function(t){var n=this,i=n.$wrapper.find("."+n.classes.messages);s.each(t||{},function(r,t){var e=n.getFormInput(r),o=[];s.each((t="string"==typeof t?[t]:t)||[],function(t,e){e=n.formatInfoMessage(e,!1,r);e.data("code",t).attr("data-code",t),o.push(e)}),e.length?e.after(o):i.show().append(o)}),n.triggerEvent("wa_auth_form_change_view")},r.prototype.clearErrors=function(t){var e=this,r=e.$wrapper,o=r.find("."+e.classes.error_input),n=!1;o.removeClass(e.classes.error_input);n=n||0<o.length,o=r.find("."+e.classes.error_msg);t||(o=o.not("[data-not-clear=1]")),n=n||0<o.length,o.each(function(){var t=s(this);"timeout"===t.data("name")&&t.data("timer")&&t.data("timer")&&"function"==typeof t.data("timer").finish&&t.data("timer").finish()}),o.remove(),r.find("."+e.classes.uncaught_errors).find("."+e.classes.error_msg).length<=0&&(r.find("."+e.classes.uncaught_errors).hide(),n=!0),n&&e.triggerEvent("wa_auth_form_change_view")},r.prototype.getErrorTemplate=function(t,e,r){return this.$templates.error_msg},r.prototype.escape=function(t){var e=s("<div>");return e.text(s.trim(""+t)),t=e.text(),e.remove(),t},r.prototype.prepareErrorText=function(t,e,r){return this.escape(e)},r.prototype.prepareErrorItem=function(t,e,r){var o=this.getErrorTemplate(t,e,r).clone().clone();return o.data("name",t).data("code",r).attr("data-name",t).attr("data-code",r),o.html(this.prepareErrorText(t,e,r)),o},r.prototype.showInputError=function(t,e){t=this.getFormInput(t);return!!t.length&&(t.parent().append(e),t.addClass(this.classes.error_input),!0)},r.prototype.getFormInput=function(t){var e=this.getFormItem(),t=this.buildFormInputName(t);return e.find('[name="'+t+'"]')},r.prototype.buildFormInputName=function(t){var e=this.namespace;return e?e+"["+t+"]":t},r.prototype.getFormField=function(t){return this.$wrapper.find("."+this.classes.field+'[data-field-id="'+t+'"]')},r.prototype.getInfoMessageItem=function(t,e){t=this.$wrapper.find("."+this.classes.message_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.getErrorItem=function(t,e){t=this.$wrapper.find("."+this.classes.error_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.showUncaughtErrors=function(t,e,r){var o=this.$wrapper.find("."+this.classes.uncaught_errors);return!!o.length&&(o.show(),r&&o.html(""),o.show().append(e),!0)},r.prototype.afterShowErrors=function(){},r.prototype.showErrors=function(t){var r=this;s.each(t||{},function(t,e){e=r.prepareErrorItems(t,e="string"==typeof e?[e]:e);r.showInputError(t,e)||r.showUncaughtErrors(t,e,!0)||!console||!console.error||s.each(e,function(){var t="Uncaught validate error: "+s(this).text();console.error(t)})}),r.afterShowErrors(),r.triggerEvent("wa_auth_form_change_view")},r.prototype.initSubmit=function(){function r(t){(t=e.onSubmit(t))&&(n&&n.abort(),n=t)}var e=this,o=e.getFormItem(),n=null;o.is("form")?o.submit(function(t){r(t)}):(o.on("click",":submit,button",function(t){var e=s(this);e.is(":disabled")||e.data("ignore")||(t.preventDefault(),r(t))}),o.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),o.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},r.prototype.validate=function(){return{}},r.prototype.initErrorsAutoCleaner=function(){var n=this,t=n.getFormItem(),i={},e=":text:not([name="+n.buildFormInputName("captcha")+"]),:password";t.find(e).each(function(){var t=s(this),e=t.attr("name"),t=t.val();i[e]={val:s.trim(t||""),timer:null}}),t.on("keydown",e,function(t){var e,r,o;13!=t.keyCode&&(t=(e=s(this)).attr("name"),r=i[t]||{},o=s.trim(r.val||""),(t=r.timer||null)&&clearTimeout(t),r.timer=setTimeout(function(){var t=s.trim(e.val()||"");t!==o&&n.clearErrors(),r.val=t},300))}),t.on("change",":input",function(){var t=s(this),e=t.attr("name"),r=i[e]||{},e=s.trim(r.val||""),t=s.trim(t.val()||"");t!==e&&n.clearErrors(),r.val=t})},r.prototype.onDoneSubmitHandlers=function(){var r=this;return{errors:function(t,e){return r.showErrors(t),!0},redirect:function(t){return-1!==(t=t||"").indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(t){return r.showInfoMessages(t),!0},rest:function(t){return!0}}},r.prototype.onDoneSubmit=function(t){var e=this.onDoneSubmitHandlers(),r=t&&"ok"===t.status,o=(t&&t.data||{}).messages||{},n=t&&t.errors||{};if(r||!(e.errors&&e.errors(n,t))){if(this.isRedirectResponse(t)){n=this.getRedirectUrl(t);if(e.redirect&&e.redirect(n,t))return}!s.isEmptyObject(o)&&(e.messages&&e.messages(o,t))||e.rest&&e.rest(t)}},r.prototype.submit=function(t){t=t||{};var e=this;if(e.beforeSubmit(),e.clearErrors(!0),e.js_validate){var r=e.validate();if(!s.isEmptyObject(r))return void e.showErrors(r)}var r=e.getFormItem(),o=t.$button||r.find(":submit"),n=t.$loading||r.find(".wa-loading"),r=t.url||e.getFormAction(),t=e.getSerializedFormData();return n.show(),o.attr("disabled",!0),e.jsonPost(r,t).done(function(t){e.isRedirectResponse(t)||(o.attr("disabled",!1),n.hide()),e.onDoneSubmit(t)}).fail(function(){o.attr("disabled",!1)})},r.prototype.onSubmit=function(t){if(this.isJsonMode())return t.preventDefault(),this.submit()},r.prototype.mixinVarsInData=function(t,r){return s.isPlainObject(r)?r=s.extend(r,t):s.isArray(r)?s.each(t,function(t,e){r.push({name:t,value:e})}):r&&s.each(t,function(t,e){r+="&"+t+"="+e}),r},r.prototype.beforeJsonPost=function(t,e){var r={wa_json_mode:1,need_redirects:this.need_redirects?1:0};return e=this.mixinVarsInData(r,e)},r.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},r.prototype.getRedirectUrl=function(t){t=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof t?t:null},r.prototype.jsonPost=function(t,e){var r=this;return e=r.beforeJsonPost(t,e),s.post(t,e,"json").always(function(t){r.isRedirectResponse(t)||s(".wa-captcha-refresh").trigger("click")})},r.prototype.beforeErrorTimerStart=function(t,e,r){},r.prototype.afterErrorTimerFinish=function(t,e,r){},r.prototype.prepareTimeoutErrorItem=function(t,e,r){var o=this,n=o.prepareErrorItem("timeout",t);return r=r||{},o.beforeErrorTimerStart(t,e,r),n.data("notClear",1).attr("data-not-clear",1),o.runTimeoutMessage(n,{timeout:e,onFinish:function(){n.remove(),o.afterErrorTimerFinish(t,e,r)}}),n},r.prototype.prepareErrorItems=function(r,t){var e,o,n=this,i=[];return"timeout"===r?(e=t.message,o=t.timeout,i=[n.prepareTimeoutErrorItem(e,o,{error_namespace:r})]):s.each(t||[],function(t,e){t="timeout"===t?n.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):n.prepareErrorItem(r,e,t);i.push(t)}),i},r.prototype.runTimeoutMessage=function(o,t){var n=t.timeout,e=s.trim(o.html()),r=t.onFinish,i=null,n=parseInt(n,10);if(n=!isNaN(n)&&0<n?n:60,r="function"==typeof r?r:null,e.match(/\d+:\d/)){this.triggerEvent("wa_auth_form_change_view");function a(){i&&clearInterval(i),o.remove(),r&&r()}i=setInterval(function(){var t,e,r;--n<=0?a():(r=o.html(),t=parseInt(n/60,10),e=n%60,r=r.replace(/\d+:\d+/,(t<=9?"0"+t:t)+":"+(e<=9?"0"+e:e)),o.html(r))},1e3),e={finish:a};return o.data("timer",e),e}},r}(jQuery),WaLoginAbstractLoginForm=function(a){var r=WaLoginAbstractLoginForm=function(){};r.className="WaLoginAbstractLoginForm";var o=WaLoginAbstractForm,n=WaLoginAbstractForm.def;return((r.prototype=Object.create(o.prototype)).constructor=r).prototype.init=function(t){o.prototype.init.call(this,t)},r.prototype.initVars=function(t){var e=this;e.auth_type=n(e.auth_type,(t=t||{}).auth_type,""),e.className=n(e.className,r.className),o.prototype.initVars.call(e,t),e.timeout=n(e.timeout,0),e.timeout=isNaN(e.timeout)||e.timeout<=0?60:e.timeout,e.form_type="login"},r.prototype.setFocus=function(){var t=this.getFormInput("login"),e=this.getFormInput("password");(a.trim(t.val()||"")?e:t).focus()},r.prototype.validate=function(o){var n=this,t=n.getSerializedFormData(),i={};return a.each(t,function(t,e){var r=e.name,e=a.trim(e.value||"");r!==n.buildFormInputName("login")||e||(i.login=[n.locale.login_required||n.locale.required||""]),r!==n.buildFormInputName("captcha")||e||(i.captcha=[n.locale.captcha_required||n.locale.required||""]),o||r!==n.buildFormInputName("password")||e||(i.password=[n.locale.password_required||n.locale.required||""])}),i},r.prototype.prepareErrorItem=function(t,e,r){e=o.prototype.prepareErrorItem.call(this,t,e,r);return this.isOneTimePasswordMode()&&"password"===t&&"out_of_tries"===r&&(t=this.getFormInput("password"),r=this.getFormItem(),t.attr("readonly",!0),r.find(".wa-login-submit").attr("disabled",!0)),e},r.prototype.isOneTimePasswordMode=function(){return"onetime_password"===this.auth_type},r.prototype.onSentOnetimePassword=function(t){this.showInfoMessages((t=t||{}).messages||{})},r.prototype.initOnetimePasswordLink=function(t){var r,o=this,n=(t=t||{}).$link,i=t.$loading;n.length&&o.isOneTimePasswordMode()&&(r=null,n.data("ignore","1"),n.on("click",function(t){if(t.preventDefault(),o.clearErrors(),o.js_validate){var e=o.validate(!0);if(!a.isEmptyObject(e))return void o.showErrors(e)}r||(t=n.attr("href")||n.data("href"),i.show(),n.attr("disabled",!0),e=o.getSerializedFormData(),o.clearErrors(),r=o.jsonPost(t,e).done(function(t){n.attr("disabled",!1),t&&"ok"===t.status?o.onSentOnetimePassword(t.data):o.showErrors(t&&t.errors||{})}).fail(function(){n.attr("disabled",!1)}).always(function(){r=null,i.hide()}))}))},r}(jQuery),WaFrontendLogin=function(c){var r=function(t){this.init(t)};r.className="WaFrontendLogin";var s=WaLoginAbstractLoginForm;return r.prototype=Object.create(s.prototype),(r.prototype.constructor=r).prototype.init=function(t){s.prototype.init.call(this,t),this.initView()},r.prototype.initVars=function(t){var e=this;t=t||{},e.$templates={confirm_email_error:c('<div class="wa-error-msg wa-confirm-email-error"></div>')},e.classes={field:"wa-field"},s.prototype.initVars.call(e,t),e.className=r.className,e.is_onetime_password_auth_type=t.is_onetime_password_auth_type||!1,e.env="frontend",e.is_need_confirm=t.is_need_confirm||!1},r.prototype.initView=function(){var t=this;t.isOneTimePasswordMode()&&t.initOnetimePasswordView(),t.isNeedConfirm()&&t.initConfirmView(),t.initAuthAdapters()},r.prototype.initAuthAdapters=function(){var t=this.$wrapper.find(".wa-adapters-section");if(!t.length)return!1;t.on("click","a",function(t){t.preventDefault(),function(t){{var e,r,o,n;t.data("id")&&(e=t.data("width")||600,r=t.data("height")||500,o=(screen.width-e)/2,n=(screen.height-r)/2,t=t.attr("href"),window.open(t,"oauth","width="+e+",height="+r+",left="+o+",top="+n+",status=no,toolbar=no,menubar=no"))}}(c(this))})},r.prototype.isNeedConfirm=function(){return this.is_need_confirm},r.prototype.initConfirmView=function(){var r=this,t=r.$wrapper,o=t.find(".wa-edit-login-link-wrapper"),e=t.find(".wa-send-again-confirmation-code-link-wrapper"),n=t.find(".wa-signup-form-confirmation-block"),i=r.getFormInput("login");r.turnOffBlock(n),r.turnOffBlock(o),r.turnOffBlock(e),o.click(function(){r.turnOffBlock(n),i.removeAttr("readonly");var t=r.getFormItem(),e=t.find(":submit:first:not(:disabled)");e.length||((e=t.find(":submit:first")).attr("disabled",!1),r.getFormInput("confirmation_code").removeAttr("readonly").val("")),r.turnOffBlock(o)}),e.click(function(){r.turnOffBlock(n);var t=r.getFormItem(),e=t.find(":submit:first:not(:disabled)");e.length||((e=t.find(":submit:first")).attr("disabled",!1),r.getFormInput("confirmation_code").removeAttr("readonly").val("")),e.trigger("click")})},r.prototype.initOnetimePasswordView=function(){function t(){e.turnOffBlock(r.find(".wa-buttons-wrapper")),e.turnOnBlock(r.find(".wa-request-onetime-password-button-wrapper")),e.turnOffBlock(e.getFormField("password")),r.find(".wa-send-again-onetime-password-link-wrapper").hide(),r.find(".wa-send-onetime-password-edit-link-wrapper").hide(),e.getFormInput("login").removeAttr("readonly")}var e=this,r=e.$wrapper;t(),e.initOnetimePasswordLink({$link:r.find(".wa-request-onetime-password-button"),$loading:r.find(".wa-request-onetime-password-button-loading")}),e.initOnetimePasswordLink({$link:r.find(".wa-send-again-onetime-password-link"),$loading:r.find(".wa-send-again-onetime-password-link-loading")}),r.on("click",".wa-send-onetime-password-edit-link",function(){t()})},r.prototype.onSentOnetimePassword=function(t){var e=this,r=e.$wrapper;"email"===(t=t||{}).used_channel_type?r.find(".wa-onetime-password-transport-message").html(e.locale.sent_by_email||""):"sms"===t.used_channel_type&&r.find(".wa-onetime-password-transport-message").html(e.locale.sent_by_sms||"");var o=e.formatInfoMessage(t.onetime_password_timeout_message,!1,"timeout");r.find(".wa-onetime-password-input-message").html(o);var n=e.getFormField("password"),i=e.getFormInput("password");e.turnOnBlock(n),i.removeAttr("readonly").val(""),e.turnOnBlock(r.find(".wa-buttons-wrapper")),e.turnOffBlock(r.find(".wa-request-onetime-password-button-wrapper")),e.getFormInput("login").attr("readonly",1);var a=r.find(".wa-send-again-onetime-password-link-wrapper").hide(),s=r.find(".wa-send-onetime-password-edit-link-wrapper").hide();e.runTimeoutMessage(o,{timeout:t.onetime_password_timeout,onFinish:function(){a.show(),s.show()}})},r.prototype.prepareErrorText=function(t,e,r){return"login"===t&&"confirm_email"===r||"confirm_email"===t?c.trim(e||""):s.prototype.prepareErrorText.apply(this,arguments)},r.prototype.getErrorTemplate=function(t,e,r){return"login"===t&&"confirm_email"===r||"confirm_email"===t?this.$templates.confirm_email_error:s.prototype.getErrorTemplate.apply(this,arguments)},r.prototype.prepareErrorItem=function(t,e,r){var o=this;if("login"===t&&"confirm_email"===r||"confirm_email"===t){var n,i=":ERROR-"+(""+Math.random()).slice(2)+":";(n=s.prototype.prepareErrorItem.call(o,t,i,r)).attr("data-not-clear","1");var a=(a=c("<div>").append(n).html()).replace(i,e);return o.getErrorItem(t,r).remove(),a}if(n=s.prototype.prepareErrorItem.call(o,t,e,r),"confirmation_code"!==t||"out_of_tries"!==r)return n;r=o.getFormInput("confirmation_code"),o=o.getFormItem();return r.attr("readonly",!0),o.find(".wa-login-submit").attr("disabled",!0),n},r.prototype.hideOauthAdaptersBlock=function(){this.$wrapper.find(".wa-adapters-section").hide()},r.prototype.beforeJsonPost=function(t,e){return this.hideOauthAdaptersBlock(),s.prototype.beforeJsonPost.call(this,t,e)},r.prototype.beforeErrorTimerStart=function(t,e,r){s.prototype.beforeErrorTimerStart(t,e,r)},r.prototype.afterErrorTimerFinish=function(t,e,r){s.prototype.afterErrorTimerFinish(t,e,r),this.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").show()},r.prototype.clearTimeoutMessage=function(){var t=this.$wrapper.find(".wa-confirmation-code-input-message").find("."+this.classes.message_msg+'[data-name="timeout"]');!t.length||(t=t.data("timer"))&&t.finish()},r.prototype.onConfirmPhoneError=function(t){var e=this,r=e.$wrapper,o=r.find(".wa-edit-login-link-wrapper"),n=r.find(".wa-send-again-confirmation-code-link-wrapper"),i=r.find(".wa-signup-form-confirmation-block"),a=r.find('[name="confirmation_code"]'),s=e.getFormInput("login");e.turnOnBlock(o),e.turnOnBlock(i),s.attr("readonly",1),a&&a.focus();var p,s=t.data,a=t.errors,t=r.find(".wa-confirmation-code-input-message");s.code_sent?(p=c(),r=c(),s.code_sent_message&&(p=e.formatInfoMessage(s.code_sent_message,!1,"code_sent_message"),t.append(p)),s.code_sent_timeout_message&&(e.clearTimeoutMessage(),r=e.formatInfoMessage(s.code_sent_timeout_message,!1,"timeout"),t.append(r)),n.hide(),e.runTimeoutMessage(r,{timeout:s.code_sent_timeout,onFinish:function(){n.show(),p.hide()}})):a.confirmation_code&&a.confirmation_code.timeout&&e.clearTimeoutMessage()},r.prototype.onDoneSubmitHandlers=function(){var r=this,t=s.prototype.onDoneSubmitHandlers.call(r);return t.errors=function(t,e){return c.isEmptyObject(t.confirmation_code)||r.onConfirmPhoneError(e),r.showErrors(t),!0},t.rest=function(t){t.data.code_sent?r.onConfirmPhoneError(t):"ok"===t.data.auth_status&&r.triggerEvent("wa_auth_contact_logged",t.data.contact||{})},t},r}(jQuery);
//# sourceMappingURL=login-frontend-form.min.js.map
