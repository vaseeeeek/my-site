var WaLoginAbstractForm=function(t){var r=function(){},e=r;e.className="WaLoginAbstractForm",e.def=function(t,r){for(var e=0,a=arguments.length;e<a;e++)if(void 0!==arguments[e])return arguments[e]};var a=e.def;return e.inherit=function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t},e.prototype.init=function(t){var r=this;r.initVars(t),r.initSubmit(),r.initErrorsAutoCleaner(),r.showErrors(r.errors),r.setFocus(),r.initCaptcha()},e.prototype.initVars=function(r){var o=this;r=r||{},o.$wrapper=a(o.$wrapper,r.$wrapper,t()),o.$form||(o.$form=o.$wrapper.find(".js-wa-form-item"),o.$form.length||(o.$form=o.$wrapper.find("form")),o.$form.length||(o.$form=t())),o.namespace=a(o.namespace,r.namespace,""),o.$templates=a(o.$templates,r.$templates,{}),o.$templates=t.extend({error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},o.$templates),o.classes=a(o.classes,r.classes,{}),o.classes=t.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},o.classes),o.errors=a(o.errors,r.errors,{}),o.locale=a(o.locale,r.locale,{}),o.js_validate=a(o.js_validate,r.js_validate,!0),o.is_json_mode=a(o.is_json_mode,r.is_json_mode),o.className=a(o.className,e.className),o.$captcha=a(o.$captcha,o.$wrapper.find(".wa-captcha-field")),o.need_redirects=void 0===r.need_redirects||!!r.need_redirects,o.env="",o.form_type=""},e.prototype.getFormItem=function(){return this.$form},e.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},e.prototype.getSerializedFormData=function(){var t=this,r=t.getFormItem();return r.is("form")?r.serializeArray():(r.find("[data-turn-off=1]").find(":input").attr("disabled",!0),r.find(":input:not(:disabled)").serializeArray())},e.prototype.beforeSubmit=function(){var t=this,r=t.getFormItem(),e=function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""};r.find('[name="_csrf"]').val(e)},e.prototype.setFocus=function(){},e.prototype.triggerEvent=function(t){var r=this,e={env:r.env,form_type:r.form_type,form_wrapper_id:r.$wrapper.attr("id")},a=Array.prototype.slice.call(arguments),a=a.slice(1);r.$wrapper.trigger(t,a.concat([e]))},e.prototype.initCaptcha=function(){var r=this;r.$wrapper.find(".wa-captcha-field").length?t(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view")}):r.triggerEvent("wa_auth_form_loaded")},e.prototype.turnOffBlock=function(r){var e=this;r.data("turnOff",1).attr("data-turn-off",1).hide(),r.find(":input").attr("disabled",!0),r.find("[type=button],:submit").each(function(){var r=t(this),a=t('<div class="wa-js-old-button-place"></div>'),o=t('<div class="wa-js-new-button-place"></div>');r.after(a),a.data("button",r),o.hide(),e.getFormItem().append(o),o.html(r)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.turnOnBlock=function(r){var e=this;r.find(".wa-js-old-button-place").each(function(){var r=t(this),e=r.data("button"),a=e.parent();r.after(e),r.remove(),a.remove()}),r.data("turnOff","").attr("data-turn-off","").show(),r.find(":input").attr("disabled",!1),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.formatInfoMessage=function(r,e,a){e=void 0===e||e;var o=this,n=o.$templates.info_msg,i=n.clone();return void 0!==a&&i.data("name",a).attr("data-name",a),e?i.text(t.trim(""+r)):i.html(t.trim(""+r))},e.prototype.getInfoMessages=function(t){var r=this,e=r.$wrapper,a="."+r.classes.message_msg;return t&&(a+='[data-name="'+t+'"]'),e.find(a)},e.prototype.clearInfoMessages=function(t){var r=this;r.getInfoMessages(t).remove(),r.triggerEvent("wa_auth_form_change_view")},e.prototype.showInfoMessages=function(r){var e=this,a=e.$wrapper,o=a.find("."+e.classes.messages);t.each(r||{},function(r,a){var n=e.getFormInput(r);"string"==typeof a&&(a=[a]);var i=[];t.each(a||[],function(t,a){var o=e.formatInfoMessage(a,!1,r);o.data("code",t).attr("data-code",t),i.push(o)}),n.length?n.after(i):o.show().append(i)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.clearErrors=function(r){var e=this,a=e.$wrapper,o=a.find("."+e.classes.error_input),n=!1;o.removeClass(e.classes.error_input),n=n||o.length>0;var i=a.find("."+e.classes.error_msg);r||(i=i.not("[data-not-clear=1]")),n=n||i.length>0,i.each(function(){var r=t(this);"timeout"===r.data("name")&&r.data("timer")&&r.data("timer")&&"function"==typeof r.data("timer").finish&&r.data("timer").finish()}),i.remove(),a.find("."+e.classes.uncaught_errors).find("."+e.classes.error_msg).length<=0&&(a.find("."+e.classes.uncaught_errors).hide(),n=!0),n&&e.triggerEvent("wa_auth_form_change_view")},e.prototype.getErrorTemplate=function(t,r,e){return this.$templates.error_msg},e.prototype.escape=function(r){var e=t("<div>");return e.text(t.trim(""+r)),r=e.text(),e.remove(),r},e.prototype.prepareErrorText=function(t,r,e){return this.escape(r)},e.prototype.prepareErrorItem=function(t,r,e){var a=this,o=a.getErrorTemplate(t,r,e).clone(),n=o.clone();return n.data("name",t).data("code",e).attr("data-name",t).attr("data-code",e),n.html(a.prepareErrorText(t,r,e)),n},e.prototype.showInputError=function(t,r){var e=this,a=e.getFormInput(t);return!!a.length&&(a.parent().append(r),a.addClass(e.classes.error_input),!0)},e.prototype.getFormInput=function(t){var r=this,e=r.getFormItem(),a=r.buildFormInputName(t);return e.find('[name="'+a+'"]')},e.prototype.buildFormInputName=function(t){var r=this,e=r.namespace;return e?e+"["+t+"]":t},e.prototype.getFormField=function(t){var r=this;return r.$wrapper.find("."+r.classes.field+'[data-field-id="'+t+'"]')},e.prototype.getInfoMessageItem=function(t,r){var e=this,a=e.$wrapper,o=a.find("."+e.classes.message_msg+'[data-name="'+t+'"]');return void 0!==r?o.filter('[data-code="'+r+'"]'):o},e.prototype.getErrorItem=function(t,r){var e=this,a=e.$wrapper,o=a.find("."+e.classes.error_msg+'[data-name="'+t+'"]');return void 0!==r?o.filter('[data-code="'+r+'"]'):o},e.prototype.showUncaughtErrors=function(t,r,e){var a=this,o=a.$wrapper,n=o.find("."+a.classes.uncaught_errors);return!!n.length&&(n.show(),e&&n.html(""),n.show().append(r),!0)},e.prototype.afterShowErrors=function(){},e.prototype.showErrors=function(r){var e=this;t.each(r||{},function(r,a){"string"==typeof a&&(a=[a]);var o=e.prepareErrorItems(r,a),n=e.showInputError(r,o);n||(n=e.showUncaughtErrors(r,o,!0)),!n&&console&&console.error&&t.each(o,function(){var r="Uncaught validate error: "+t(this).text();console.error(r)})}),e.afterShowErrors(),e.triggerEvent("wa_auth_form_change_view")},e.prototype.initSubmit=function(){var r=this,e=r.getFormItem(),a=null,o=function(t){var e=r.onSubmit(t);e&&(a&&a.abort(),a=e)};e.is("form")?e.submit(function(t){o(t)}):(e.on("click",":submit,button",function(r){var e=t(this);e.is(":disabled")||e.data("ignore")||(r.preventDefault(),o(r))}),e.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),e.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},e.prototype.validate=function(){return{}},e.prototype.initErrorsAutoCleaner=function(){var r=this,e=r.getFormItem(),a={},o=r.buildFormInputName("captcha"),n=":text:not([name="+o+"]),:password";e.find(n).each(function(){var r=t(this),e=r.attr("name"),o=r.val();a[e]={val:t.trim(o||""),timer:null}}),e.on("keydown",n,function(e){if(13!=e.keyCode){var o=t(this),n=o.attr("name"),i=a[n]||{},s=t.trim(i.val||""),c=i.timer||null;c&&clearTimeout(c),i.timer=setTimeout(function(){var e=t.trim(o.val()||"");e!==s&&r.clearErrors(),i.val=e},300)}}),e.on("change",":input",function(){var e=t(this),o=e.attr("name"),n=a[o]||{},i=t.trim(n.val||""),s=t.trim(e.val()||"");s!==i&&r.clearErrors(),n.val=s})},e.prototype.onDoneSubmitHandlers=function(){var t=this;return{errors:function(r,e){return t.showErrors(r),!0},redirect:function(t){return t=t||"",-1!==t.indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(r){return t.showInfoMessages(r),!0},rest:function(t){return!0}}},e.prototype.onDoneSubmit=function(r){var e=this,a=e.onDoneSubmitHandlers(),o=r&&"ok"===r.status,n=r&&r.data||{},i=n.messages||{},s=r&&r.errors||{};if(o||!(a.errors&&a.errors(s,r))){if(e.isRedirectResponse(r)){var c=e.getRedirectUrl(r);if(a.redirect&&a.redirect(c,r))return}!t.isEmptyObject(i)&&(a.messages&&a.messages(i,r))||a.rest&&a.rest(r)}},e.prototype.submit=function(r){r=r||{};var e=this;if(e.beforeSubmit(),e.clearErrors(!0),e.js_validate){var a=e.validate();if(!t.isEmptyObject(a))return void e.showErrors(a)}var o=e.getFormItem(),n=r.$button||o.find(":submit"),i=r.$loading||o.find(".wa-loading"),s=r.url||e.getFormAction(),c=e.getSerializedFormData();return i.show(),n.attr("disabled",!0),e.jsonPost(s,c).done(function(t){e.isRedirectResponse(t)||(n.attr("disabled",!1),i.hide()),e.onDoneSubmit(t)}).fail(function(){n.attr("disabled",!1)})},e.prototype.onSubmit=function(t){var r=this;if(r.isJsonMode())return t.preventDefault(),r.submit()},e.prototype.mixinVarsInData=function(r,e){return t.isPlainObject(e)?e=t.extend(e,r):t.isArray(e)?t.each(r,function(t,r){e.push({name:t,value:r})}):e&&t.each(r,function(t,r){e+="&"+t+"="+r}),e},e.prototype.beforeJsonPost=function(t,r){var e=this,a={wa_json_mode:1,need_redirects:e.need_redirects?1:0};return r=e.mixinVarsInData(a,r)},e.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},e.prototype.getRedirectUrl=function(t){var r=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof r?r:null},e.prototype.jsonPost=function(r,e){var a=this;return e=a.beforeJsonPost(r,e),t.post(r,e,"json").always(function(r){a.isRedirectResponse(r)||t(".wa-captcha-refresh").trigger("click")})},e.prototype.beforeErrorTimerStart=function(t,r,e){},e.prototype.afterErrorTimerFinish=function(t,r,e){},e.prototype.prepareTimeoutErrorItem=function(t,r,e){var a=this,o=a.prepareErrorItem("timeout",t);return e=e||{},a.beforeErrorTimerStart(t,r,e),o.data("notClear",1).attr("data-not-clear",1),a.runTimeoutMessage(o,{timeout:r,onFinish:function(){o.remove(),a.afterErrorTimerFinish(t,r,e)}}),o},e.prototype.prepareErrorItems=function(r,e){var a=this,o=[];if("timeout"===r){var n=e.message,i=e.timeout,s=a.prepareTimeoutErrorItem(n,i,{error_namespace:r});o=[s]}else t.each(e||[],function(t,e){var n;n="timeout"===t?a.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):a.prepareErrorItem(r,e,t),o.push(n)});return o},e.prototype.runTimeoutMessage=function(r,e){var a=this,o=e.timeout,n=t.trim(r.html()),i=e.onFinish,s=null;if(o=parseInt(o,10),o=!isNaN(o)&&o>0?o:60,i="function"==typeof i?i:null,n.match(/\d+:\d/)){a.triggerEvent("wa_auth_form_change_view");var c=function(){s&&clearInterval(s),r.remove(),i&&i()};s=setInterval(function(){if((o-=1)<=0)return void c();var t=r.html(),e=parseInt(o/60,10),a=o%60,n=e<=9?"0"+e:e,i=a<=9?"0"+a:a;t=t.replace(/\d+:\d+/,n+":"+i),r.html(t)},1e3);var p={finish:c};return r.data("timer",p),p}},e}(jQuery),WaLoginAbstractSetPasswordForm=function(t){var r=WaLoginAbstractSetPasswordForm=function(){};r.className="WaLoginAbstractSetPasswordForm";var e=WaLoginAbstractForm,a=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(r,e),r.prototype.initVars=function(t){var o=this;o.className=a(o.className,r.className),e.prototype.initVars.call(o,t),o.form_type="setpassword"},r.prototype.validate=function(){var r=this,e=r.getSerializedFormData(),a={};t.each(e,function(e,o){var n=o.name,i=t.trim(o.value||"");return n!==r.buildFormInputName("login")||i?n!==r.buildFormInputName("password")||i?n!==r.buildFormInputName("captcha")||i?void 0:void(a.captcha=[r.locale.captcha_required||r.locale.required||""]):void(a.password=[r.locale.password_required||r.locale.required||""]):void(a.login=[r.locale.login_required||r.locale.required||""])});var o=r.getFormInput("password"),n=r.getFormInput("password_confirm");return t.trim(o.val()||"")!==t.trim(n.val()||"")&&(a.password_confirm=[r.locale.not_match||""]),a},r}(jQuery),WaBackendSetPassword=function(t){var r=function(t){this.init(t)},e=r;e.className="WaBackendSetPassword";var a=WaLoginAbstractSetPasswordForm;return WaLoginAbstractForm.inherit(e,a),e.prototype.initVars=function(t){var r=this;r.className=e.className,a.prototype.initVars.call(r,t),r.env="backend"},e}(jQuery);
//# sourceMappingURL=setpassword-backend-form.min.js.map
