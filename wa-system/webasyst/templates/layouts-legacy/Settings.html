{$_locale_string = substr($wa->locale(), 0, 2)}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>[s`Settings`] &mdash; {$wa->accountName()}</title>
    {$wa->css()}

    <link href="{$wa_url}wa-content/css/wa-settings/legacy/settings.css?v={$wa->version()}" rel="stylesheet">
    <link href="{$wa_url}wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.css" rel="stylesheet">

    {* VENDOR *}
    {wa_js}
        {$wa_url}wa-content/js/jquery/jquery-1.11.1.min.js
        {$wa_url}wa-content/js/jquery/jquery-migrate-1.2.1.min.js
        {$wa_url}wa-content/js/jquery-ui/jquery.ui.core.min.js
        {$wa_url}wa-content/js/jquery-ui/jquery.ui.widget.min.js
        {$wa_url}wa-content/js/jquery-ui/jquery.ui.mouse.min.js
        {$wa_url}wa-content/js/jquery-ui/jquery.ui.sortable.min.js
        {$wa_url}wa-content/js/jquery-ui/jquery.ui.progressbar.min.js
        {$wa_url}wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js
        {$wa_url}wa-content/js/ace/ace.js
        {$wa_url}wa-content/js/jquery-wa/wa.elrte.ace.js
    {/wa_js}

    {* SETTINGS *}
    {wa_js}
        {$wa_url}wa-content/js/jquery-wa/wa.core.js
        {$wa_url}wa-content/js/jquery-wa/wa.dialog.js
        {$wa_url}wa-content/js/jquery-wa/wa.contentrouter.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.general.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.email.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.maps.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.captcha.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.push.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.sms.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.auth.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.field.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.field.edit.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.field.delete.confirm.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.regions.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.db.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.db.list.dialog.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.waID.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.waIDInviteProgress.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.waIDConnectDialog.js
        {$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.waIDDisconnectConfirm.js
        {$wa_url}wa-content/js/dialog/dialog.js
    {/wa_js}

    <link type="text/css" rel="stylesheet" href="{$wa_url}wa-content/css/wa-settings/legacy/settingsDialog.css?v{$wa->version()}">
    <link type="text/css" href="{$wa_url}wa-content/js/dialog/dialog.css?{$wa->version()}" rel="stylesheet" />

    <script src="{$wa_url}wa-content/js/jquery-wa/wa-settings/legacy/settings.dialog.js?v{$wa->version()}"></script>

    {* @event backend_assets.%plugin_id% *}
    {foreach $backend_assets as $item}
        {$item}
    {/foreach}

    {$wa->js()}

</head>
<body><div id="wa">

    {$wa->header()}

    <div id="wa-app">
        <div class="s-main-wrapper" id="s-main-wrapper">

            {* SIDEBAR *}
            <section class="s-sidebar-wrapper sidebar left200px" id="s-sidebar-wrapper">
                {$sidebar}
            </section>

            {* CONTENT *}
            <section class="s-content-wrapper content shadowed left200px">
                <div class="s-content-block" id="s-content-block">
                    {$content}
                </div>
            </section>
        </div>

    </div>
    <script>
        (function($) { "use strict";

            {* need for editor2.js *}
            window.wa_app = {$wa->app()|json_encode};
            {* need for waEditorAceInit *}
            window.wa_url = {$wa_url|json_encode};

            var $doc = $(document),
                $wrapper = $('#s-main-wrapper'),
                $content = $("#s-content-block"),
                before_load_content_event = 'wa_before_load.webasyst-settings';

            var changeUrlHandler = function(params) {
                // auto off
                if (!$wrapper.length) {
                    $doc.off(before_load_content_event);
                    return;
                }

                params = params || {};

                {* Hide connect announcement banner of waid settings page, and show in other pages (of cource if banner in DOM) *}
                var content_uri = params.content_uri || location.href || '';
                if (content_uri.indexOf('waid') > -1) {
                    $('.js-webasyst-id-connect-announcement').hide();
                    $('.js-webasyst-id-auth-announcement').hide();
                } else {
                    $('.js-webasyst-id-connect-announcement').show();
                    $('.js-webasyst-id-auth-announcement').show();
                }
            };

            // Change url handling
            $doc.off(before_load_content_event).on(before_load_content_event, function (e, params) {
                changeUrlHandler(params);
            });

            // Change url handler on initial state
            changeUrlHandler();

            // content router
            $.wa.content = new ContentRouter({
                $content: $content,
                app_url: {"`$wa_backend_url`webasyst/settings/"|json_encode}
            });

        })(jQuery);
    </script>
</body>
</html>
